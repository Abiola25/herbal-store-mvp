<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Your Cart - MILNAPATH HERBAL PRODUCTS STORE</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f4f4f4; }
h2 { text-align:center; color:#2e7d32; }
.item { background:#fff; padding:15px; margin-bottom:10px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
button { padding:10px; width:100%; background:#2e7d32; color:white; border:none; border-radius:5px; cursor:pointer; margin-top:5px; transition:background 0.2s;}
button:hover { background:#1b5e20; }
input, select { padding:8px; width:100%; border-radius:5px; border:1px solid #ccc; margin-top:5px; margin-bottom:10px; }
#order-section { background:#e0f2f1; padding:15px; border-radius:8px; margin-top:20px; }
</style>
</head>
<body>

<h2>Your Cart</h2>
<div id="cart-items"></div>

<div id="order-section">
<label>
    Shipment Method:<br>
<select id="shipment">
<option value="">-- Select --</option>
<option value="Pickup">Pickup</option>
<option value="Delivery">Delivery</option>
</select>
</label>
<label>
    Upload Proof of Payment:<br>
<input type="file" id="payment-proof" accept="image/*">
</label>
<button onclick="orderWhatsApp()">Order via WhatsApp</button>
<button onclick="clearCart()" style="background:#b71c1c;">Clear Cart</button>
</div>

<script>
const STORE = {
  whatsapp: "2347039249771",
  name: "MILNAPATH HERBAL PRODUCTS STORE",
  address: "BM House, SHOP 107 Samuel Ladoke Akintola Boulevard, Garki, Abuja 900110, FCT, Nigeria"
};

let cart = JSON.parse(localStorage.getItem("cart")) || [];
const container = document.getElementById("cart-items");

async function loadCart() {
  const res = await fetch('/products');
  const products = await res.json();
  container.innerHTML = "";

  let message = `Hello, I want to order from ${STORE.name}:%0A%0A`;
  let total = 0;

  cart.forEach(item => {
    const product = products.find(p => p.id === item.id);
    if(!product) return;
    const subtotal = product.price * item.qty;
    total += subtotal;

    container.innerHTML += `
<div class="item">
<strong>${product.name}</strong><br>
        ₦${product.price} × ${item.qty} = ₦${subtotal}<br>
<button onclick="removeItem(${item.id})">Remove</button>
</div>
    `;

    message += `• ${product.name} × ${item.qty} = ₦${subtotal}%0A`;
  });

  message += `%0ATotal: ₦${total}%0A`;
  message += `%0APickup Address: ${STORE.address}`;

  window.whatsappMessage = message;
}

function removeItem(id) {
  cart = cart.filter(item => item.id !== id);
  localStorage.setItem("cart", JSON.stringify(cart));
  loadCart();
}

function clearCart() {
  localStorage.removeItem("cart");
  cart = [];
  loadCart();
}

function orderWhatsApp() {
  const shipment = document.getElementById("shipment").value;
  const fileInput = document.getElementById("payment-proof");
  let extraMsg = "";
  if(shipment) extraMsg += `%0AShipment Method: ${shipment}`;
  if(fileInput.files.length > 0) extraMsg += `%0AProof of Payment Uploaded`;

  const url = `https://wa.me/${STORE.whatsapp}?text=${window.whatsappMessage}${extraMsg}`;
  window.open(url, "_blank");

  // Save order + shipment + proof info in localStorage for admin
  const orders = JSON.parse(localStorage.getItem("orders") || "[]");
  orders.push({
    items: cart,
    shipment: shipment || "Not selected",
    proofUploaded: fileInput.files.length > 0,
    date: new Date().toLocaleString()
  });
  localStorage.setItem("orders", JSON.stringify(orders));

  alert("Order has been sent to WhatsApp and saved for admin review!");
  clearCart();
}

loadCart();
</script>

</body>
</html>
